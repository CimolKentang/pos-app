<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:converter="clr-namespace:inovasyposmobile.Converters"
             xmlns:selector="clr-namespace:inovasyposmobile.Selectors"
             xmlns:viewModel="clr-namespace:inovasyposmobile.ViewModels.Transaksi"
             xmlns:model="clr-namespace:inovasyposmobile.Models.Transaksi.Penjualan"
             x:Class="inovasyposmobile.Views.Pages.Transaksi.Penjualan.PenjualanView"
             Title="Penjualan">

    <ContentPage.Resources>
        <converter:DateTimeConverter x:Key="DateTimeConverter"></converter:DateTimeConverter>
        <converter:EmptyToDashConverter x:Key="EmptyToDashConverter"></converter:EmptyToDashConverter>
    </ContentPage.Resources>

    <ContentPage.ToolbarItems>
        <ToolbarItem Order="Secondary" Text="Logout" Clicked="Logout" />
    </ContentPage.ToolbarItems>

    <Grid
        x:DataType="viewModel:PenjualanViewModel"
        RowDefinitions="Auto,*,Auto">
        <VerticalStackLayout
            Grid.Row="0">
            <StackLayout
                Padding="5">
                <Border
                    Stroke="{AppThemeBinding Light=Black, Dark=White}"
                    StrokeShape="RoundRectangle 5">
                    <Grid
                        ColumnDefinitions="*, Auto"
                        RowDefinitions="Auto">
                        <Entry
                            Text="{Binding SearchText, Mode=TwoWay}"
                            Placeholder="Cari penjualan..."
                            PlaceholderColor="Gray"
                            Margin="0"
                            Grid.Column="0" />
                    </Grid>
                </Border>
            </StackLayout>
            <BoxView
                HeightRequest="1"
                BackgroundColor="{AppThemeBinding Dark=White,Light=Black}" />
        </VerticalStackLayout>
        <RefreshView
            Grid.Row="1"
            IsRefreshing="{Binding IsRefreshing}"
            Command="{Binding RefreshPenjualanCommand}">
            <CollectionView
                x:Name="PenjualanCollection"
                ItemsSource="{Binding Penjualans}">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="model:PenjualanModel">
                        <VerticalStackLayout>
                            <Grid
                                ColumnDefinitions="*,*"
                                RowDefinitions="Auto,Auto"
                                ColumnSpacing="5"
                                Padding="10">
                                <VerticalStackLayout
                                    Grid.Column="0"
                                    Grid.Row="0">
                                    <Label
                                        FontAttributes="Bold"
                                        FontSize="16"
                                        Text="{Binding NomorPenjualan}" />
                                    <Label
                                        Text="{Binding Tanggal,Converter={StaticResource DateTimeConverter}}" />
                                    <Label
                                        IsVisible="{Binding IsPenjualanKasir}"
                                        FontAttributes="Italic"
                                        Text="Penjualan Kasir" />
                                    <Label
                                        IsVisible="{Binding IsPenjualanKonsinyasi}"
                                        FontAttributes="Italic"
                                        Text="Penjualan Konsinyasi" />
                                </VerticalStackLayout>
                                <VerticalStackLayout
                                    Grid.Column="1"
                                    Grid.Row="0">
                                    <HorizontalStackLayout
                                        Spacing="5">
                                        <Label
                                            Text="Sales:" />
                                        <Label
                                            MaxLines="1"
                                            LineBreakMode="TailTruncation"
                                            Text="{Binding NamaSales}" />
                                    </HorizontalStackLayout>
                                    <HorizontalStackLayout
                                        Spacing="5">
                                        <Label
                                            Text="Pelanggan:" />
                                        <Label
                                            MaxLines="1"
                                            LineBreakMode="TailTruncation"
                                            Text="{Binding NamaPelanggan}" />
                                    </HorizontalStackLayout>
                                    <HorizontalStackLayout
                                        Spacing="5">
                                        <Label
                                            Text="Total:" />
                                        <Label
                                            MaxLines="1"
                                            LineBreakMode="TailTruncation"
                                            Text="{Binding Total,StringFormat='Rp. {0:N0}'}" />
                                    </HorizontalStackLayout>
                                </VerticalStackLayout>
                                <VerticalStackLayout
                                    Grid.Row="1"
                                    Margin="0,5,0,0">
                                    <Label
                                        TextDecorations="Underline"
                                        Text="Deskripsi:" />
                                    <Label
                                        Text="{Binding Deskripsi,Converter={StaticResource EmptyToDashConverter}}" />
                                </VerticalStackLayout>
                            </Grid>
                            <BoxView
                                HeightRequest="1" />
                        </VerticalStackLayout>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>
        <ActivityIndicator 
            Grid.Row="1"
            IsVisible="{Binding IsLoading}"
            IsRunning="True"
            HorizontalOptions="Center"
            VerticalOptions="Center"
            WidthRequest="50" HeightRequest="50"
            Color="{AppThemeBinding Dark=White,Light=Black}" />
        <!-- <HorizontalStackLayout
            Grid.Row="2"
            Padding="10">
            <AbsoluteLayout>
                <HorizontalStackLayout
                    Spacing="5">
                    <Label
                        VerticalOptions="Center"
                        Text="Item per halaman:" />
                    <Border
                        Padding="3"
                        StrokeShape="RoundRectangle 2">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer />
                        </Border.GestureRecognizers>
                        <Label
                            Text="{Binding PageSize}" />
                    </Border>
                </HorizontalStackLayout>
                <CollectionView
                    AbsoluteLayout.LayoutBounds="1,0,35,100"
                    AbsoluteLayout.LayoutFlags="XProportional"
                    BackgroundColor="red">
                    <CollectionView.ItemsSource>
                        <x:Array Type="{x:Type x:String}">
                            <x:String>10</x:String>
                            <x:String>25</x:String>
                            <x:String>50</x:String>
                            <x:String>100</x:String>
                        </x:Array>
                    </CollectionView.ItemsSource>
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <VerticalStackLayout
                                HeightRequest="25">
                                <Label
                                    VerticalOptions="Center"
                                    HorizontalTextAlignment="End"
                                    Text="{Binding}" />
                            </VerticalStackLayout>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </AbsoluteLayout>
        </HorizontalStackLayout> -->
    </Grid>

</ContentPage>